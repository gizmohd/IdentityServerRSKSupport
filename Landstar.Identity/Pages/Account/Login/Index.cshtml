@page
@using Landstar.Identity.Pages.Account.Login
@model Landstar.Identity.Pages.Account.Login.Index
@inject IStringLocalizer<SharedResource> Localizer

<div class="login-page">
  <div class="lead">
    <h1>@Localizer["Login"]</h1>
    <p>@Localizer["Choose how to login"]</p>
  </div>

  <partial name="_ValidationSummary" />

  <div class="row">

    @if (Model.View.EnableLocalLogin)
    {
      <div class="col-sm-6">
        <div class="card">
          <div class="card-header">
            <h2>@Localizer["Local Account"]</h2>
          </div>

          <div class="card-body">
            <form asp-page="/Account/Login/Index">
              <input type="hidden" asp-for="Input.ReturnUrl" />

              <div class="form-group">

                <input class="form-control" placeholder="@Localizer["Username"]" asp-for="Input.Username" autofocus>

              </div>
              <div class="form-group">

                <input type="password" class="form-control" placeholder="@Localizer["Password"]" asp-for="Input.Password" autocomplete="off">

              </div>

              @if (Model.View.AllowRememberLogin)
              {
                <div class="form-group">
                  <div class="form-check">
                    <label class="form-check-label" asp-for="Input.RememberLogin">
                      <input class="form-check-input" asp-for="Input.RememberLogin">
                      @Localizer["Remember My Login"]
                    </label>
                  </div>
                </div>
              }

              @if (Model.View.AllowForgotPassword)
              {
                <div class="form-group">
                  <div class="form-check">
                    <a id="forgot-password" href="/Account/ForgotPassword">@Localizer["Forgot your password?"]</a>
                  </div>
                </div>
              }
 
              <button class="btn btn-primary" name="Input.Button" value="login">@Localizer["Login"]</button>
              <button class="btn btn-secondary" name="Input.Button" value="cancel">@Localizer["Cancel"]</button>
            </form>
          </div>
        </div>
      </div>
    }

    @if (Model.View.VisibleExternalProviders.Any())
    {
      <div class="col-sm-6">
        <div class="card">
          <div class="card-header">
            <h2>@Localizer["External Account"]</h2>
          </div>
          <div class="card-body">
            <ul class="list-inline">
              @{
                List<ExternalProvider> orderedList = new();


                var oidcItems = Model.View.VisibleExternalProviders.Where(a => a.AuthenticationScheme.StartsWith("oidc", StringComparison.OrdinalIgnoreCase)).OrderBy(a => a.AuthenticationScheme);
                var nonOidcItems = Model.View.VisibleExternalProviders.Where(a => !a.AuthenticationScheme.StartsWith("oidc", StringComparison.OrdinalIgnoreCase)).OrderBy(a => a.AuthenticationScheme);

                orderedList.AddRange(oidcItems);
                orderedList.AddRange(nonOidcItems);
              }
              @foreach (var provider in Model.View.VisibleExternalProviders)
              {
                <li class="list-inline-item">
                  @* <a class="btn btn-secondary" *@
                  <a asp-page="/ExternalLogin/Challenge"
                     asp-route-scheme="@provider.AuthenticationScheme"
                     asp-route-returnUrl="@Model.Input.ReturnUrl">
                    @switch (provider.AuthenticationScheme.ToLower())
                    {
                      case "oidc":
                        <img class="btn-primary login_button" src="~/images/legacylogo.png" title="@Localizer["Landstar Online"]" />
                        break;
                      case "google":
                        <img class="login_button" src="~/images/btn_google_signin_light_normal_web.png" title="@Localizer["Sign in with Google"]" />
                        break;
                      case "oidc-adfs":
                        <img class="login_button" src="~/images/landstar_ad.png" title="@Localizer["Sign in with Landstar Corporate"]" />
                        break;
                      default:
                        @provider.DisplayName
                        break;
                    }

                  </a>
                </li>
              }
            </ul>
          </div>
        </div>
      </div>
    }

    @if (!Model.View.EnableLocalLogin && !Model.View.VisibleExternalProviders.Any())
    {
      <div class="alert alert-warning">
        <strong>@Localizer["Invalid login request"]</strong>
        @Localizer["There are no login schemes configured for this request."]"
      </div>
    }
  </div>
</div>